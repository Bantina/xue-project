/*******************************************
 *
 * 新鲜事所有事件绑定功能
 * @authors Du xin li
 * @date    2015-10-22
 * @version $Id$
 *
*********************************************/


$(function(){

    //清楚tab键盘获取焦点
   /* $('body').off('keydown').on('keydown', function(e){
         var ev = e || event;
        if (ev.keyCode == 9) {
            if (ev.preventDefault) {
                ev.preventDefault();
            }
            else {
                window.event.returnValue = false;
            }
        }    
     })*/
   

	//动态大小图片切换功能
    $('.fresh-main-wrapper').off('click', '.fresh-type-img div').on('click', '.fresh-type-img div', function(){
        var that = $(this).closest('.fresh-type-img');
        fresh.media.img.toggle(that);
    })
	
	// 动态中点击“作答”切换做题效果
    $('.fresh-main-wrapper').off('click', '.fresh-answer-btn').on('click', '.fresh-answer-btn', function(){
        fresh.media.answer.btnToggle(this);
    });

    // 点击动态试题图片切换方法
    $('.fresh-main-wrapper').off('click', '.fresh-type-answer .fresh-media-small-img').on('click', '.fresh-type-answer .fresh-media-small-img', function(e){
        var that = $(this).closest('.fresh-type-answer');
        fresh.media.answer.imgToggle(that, e);
    });

    $('.fresh-main-wrapper').off('click', '.fresh-big-img-answer').on('click', '.fresh-big-img-answer', function(e){
        fresh.media.answer.imgToggle(this, e);
    });

    // 选择动态试题答案：提交答案
    $('.fresh-main-wrapper').off('click', '.fresh-big-selectAnswer a[data-type="radio"]').on('click', '.fresh-big-selectAnswer a[data-type="radio"]', function(){
        fresh.media.answer.answerSubmit(this);
    });
    
    //点击视频小图显示视频大图效果
    $('.fresh-main-wrapper').off('click', '.fresh-type-video .fresh-media-small-video').on('click', '.fresh-type-video .fresh-media-small-video', function(){
        fresh.media.video.videoPlay(this);
    });
   
    //点击视频大图上的收起显示小图视频效果
    $('.fresh-main-wrapper').off('click', '.fresh-packUp-video').on('click', '.fresh-packUp-video', function(){
         fresh.media.video.videoHide(this);
    });


    /* ================= 评论相关 ============= */

    //点击父级评论按钮切换评论框区域和消息
    $('.fresh-main-wrapper').off('click', '.fresh-comment-expand-btn').on('click', '.fresh-comment-expand-btn', function(){
        var that = $(this);
        if(that.data('type') && that.data('type') == 2){
            return false;
        }
        fresh.comment.toggle(this);
    });

    //点击关闭评论框按钮
    $('.fresh-main-wrapper').off('click', '.fresh-comment-close-btn').on('click', '.fresh-comment-close-btn', function(){
        fresh.comment.close(this);
    });

    //限制文本域字数显示
    $('.fresh-main-wrapper').off('input keyup paste focus', '.fresh-comment-textarea textarea').on('input keyup paste focus', '.fresh-comment-textarea textarea', function(){
        var that = this;
        setTimeout(function(){
            fresh.comment.textareaNum(that);
        }, 10);
    });

    //点击发布评论内容按钮
    $('.fresh-main-wrapper').off('click', '.fresh-comment-submit-btn a').on('click', '.fresh-comment-submit-btn a', function(){
        fresh.comment.sendComment(this);
    });


    // 点击评论列表里回复区域评论切换
    $('.fresh-main-wrapper').off('click', '.fresh-comment-list .fresh-barinfo a').on('click', '.fresh-comment-list .fresh-barinfo a', function(){
        if(!$(this).hasClass('fresh-del-msg')){
            fresh.comment.replyToggle(this);
        }

    });

    // 点击表情按钮,弹出表情弹出层
    $('.fresh-main-wrapper').off('click', '.fresh-comment-emote-smiles-btn').on('click', '.fresh-comment-emote-smiles-btn', function(event){
          fresh.comment.emote(this, event);
    });

    //点击删除新鲜事和评论的删除
    $('.fresh-main-wrapper').off('click', '.fresh-barinfo a.fresh-del-msg').on('click', '.fresh-barinfo a.fresh-del-msg', function(){
         fresh.comment.delComment(this);
    });


    /* ================= 收藏相关 ============= */
    
    //点击添加收藏按钮
    $('.fresh-main-wrapper').off('click', '.fresh-collect-add-btn').on('click', '.fresh-collect-add-btn', function(){
         fresh.collect.add(this);
    });
    

    //点击取消收藏按钮
    $('.fresh-main-wrapper').off('click', '.fresh-collect-cancel-btn').on('click', '.fresh-collect-cancel-btn', function(){
         fresh.collect.cancel(this);
    });
    

    /* ================= 发布新鲜事相关 ============= */

    //限制发布新鲜事文本域字数显示
    $('body').off('input keyup paste focus', '.fresh-send-textareaBox').on('input keyup paste focus', '.fresh-send-textareaBox', function(){
        var that = this;
        setTimeout(function(){
            fresh.send.limitNum(that);
        }, 10);
    });

    // 点击表情按钮,弹出表情弹出层
    $('body').off('click', '.fresh-send-emote-click-btn').on('click', '.fresh-send-emote-click-btn', function(event){
             fresh.comment.emote(this, event, 'send');
    });

    // 发布新鲜事里面的选择上传图片
    $('body').off('change', '.fresh-send-form #fresh-fileToUpload').on('change', '.fresh-send-form #fresh-fileToUpload', function(){
        fresh.send.fileupload(this);
    });

    //点击关闭图片区域按钮
    $('body').off('click', '.fresh-send-box .fresh-preview-close').on('click', '.fresh-send-box .fresh-preview-close', function(){
        $('#fresh-send-preview').addClass('hiding');
    });

    //点击发送新鲜事按钮应该是弹出层
    $('body').off('click', ' #freshPost').on('click', '#freshPost', function(){
        fresh.send.box(this);
    })
    
    //发送新鲜事提交表单前的数据时间验证
    $('body').off('submit', 'form.fresh-send-box').on('submit', 'form.fresh-send-box', function(){
        fresh.send.checkData();
    })

    //点击发送按钮
    $('body').off('click', '.fresh-send-box .fresh-send-submit-btn').on('click', '.fresh-send-box .fresh-send-submit-btn', function(){
        var that = $(this);
        var form = that.closest('form.fresh-send-box');
        fresh.send.submit(form);
    })

    /* ================= 关注相关 ============= */

    //点击添加关注按钮
    $('.fresh-main-wrapper').off('click', '.fresh-course-attention .fresh-add-attention-btn').on('click', '.fresh-course-attention .fresh-add-attention-btn', function(){
        var that = $(this).closest('.fresh-course-attention');
        fresh.attention.addCancel(that);
    })

    //点击添加取消关注按钮
    $('.fresh-main-wrapper').off('click', '.fresh-course-attention .fresh-add-cancel-btn').on('click', '.fresh-course-attention .fresh-add-cancel-btn', function(){
        var that = $(this).closest('.fresh-course-attention');
        fresh.attention.addCancel(that);
    })

    //默认展开评论直接走fresh.getList.getList(dom);并且一个页面只有一个fresh-list评论

   /* var dom = $('.fresh-list').find('.fresh-barinfo');
    fresh.comment.getList(dom);*/

    //新鲜事推荐区域整区域增加链接和滑过效果
    $('.fresh-hover-item').hover(function(){
         $(this).addClass('fresh-hover-style');
    }, function(){
         $(this).removeClass('fresh-hover-style');
    })

    //点击详情区域事件
    $('.fresh-hover-item').off('click').on('click', function(event){
         if($(event.target).attr('href') || $(event.target).attr('date-role') == 'fresh-avatar'){
            return;//return 把控制权返回给页面,不响应这个点击事件，不能用return false,否则正常的链接无法点击使用
         }else{
            var url = $(this).find('.fresh-barinfo a').attr('href');
            window.open(url);
         }
    })

    // 点击空白处表情框隐藏
    /*$(document).on('click',function(e){
         var  c = $(e.target).hasClass() == 'fresh-emote-current';
         var  b = $(e.target).attr('class') == 'fresh-dialog-emote';
         var  a = $(e.target).parents('.fresh-dialog-emote').length !== 0;
         if (!c && !b && !a){
            $('.fresh-emote-current').attr('flag','0');
            $('.fresh-dialog-emote').addClass('hiding');
         }
    })*/

    /* ================= 新鲜事tab切换相关 ============= */

    $('body').off('click', '#fresh-filter-nav li a').on('click', '#fresh-filter-nav li a', function(){
        var that = $(this).closest('li');
        var type = that.data('type');
        fresh.tab.getDynamicList(type, that)
    })


})
